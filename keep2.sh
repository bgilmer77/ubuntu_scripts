#! /bin/sh# This script came from www.askubuntu.com/questions/2793## This script assumes that the installed linux-image and linux-headers packages# share the same versions (i.e. if a linux-image version number is installed,# the corresponding linux-headers package will also be installed, and vice# versa.)# This gets the version number (i.e. 25) of the second to most current version# running on the machineSECONDTOLASTVER=$(dpkg --list | grep linux-image | awk '{ print $2 }' | sort -r -n | sed '/^[^0-9]\+$/d' | sed 's/^.*-\([0-9\.]\+-[0-9]\+\).*/\1/' | uniq | sed -n 2p)# get a list of package names matching the argument passed to the function, and# return only those package names which should be removedget_pkgs_to_remove_matching () {if [ -n "$SECONDTOLASTVER" ]; then		echo $(dpkg --list| grep linux-image|awk '{ print $2 }'| sort | sed -n '/'"$SECONDTOLASTVER"'/q;p')fi}# This calls the function to get the names of the linux-image and linux-headers# packages to purge from the systemecho $(get_pkgs_to_remove_matching linux-image) $(get_pkgs_to_remove_matching linux-headers) | xargs sudo apt-get --dry-run purge